# 1. 创建测试计划
>Jmeter的测试计划以`.jmx`格式保存，脚本中最多只能有一个测试计划。测试计划中至少要有一个线程组。线程组中至少要有一个取样器。线程组中至少要有一个监听器。

主要组件：
- `测试计划(Test Plan)` - 可以将测试计划视为 JMeter 的测试脚本 。测试计划由测试元素组成，例如线程组，逻辑控制器，样本生成控制器，监听器，定时器，断言和配置元素。
+ `线程组(Thread Group)` - 线程组的作用是：模拟大量用户负载的运行场景。
    - 设置线程数
    - 设置加速期
    - 设置执行测试的次数
+ `控制器(Controllers)` - 可以分为两大类：
    - 采样器（Sampler） - 采样器的作用是模拟用户对目标服务器发送请求。 采样器是必须将组件添加到测试计划中的，因为它只能让 JMeter 知道需要将哪种类型的请求发送到服务器。 请求可以是 HTTP，HTTP(s)，FTP，TCP，SMTP，SOAP 等。
    - 逻辑控制器 - 逻辑控制器的作用是：控制多个请求发送的循环次数及顺序等。
- `监听器(Listeners)` - 监听器的作用是：收集测试结果信息。如查看结果树、汇总报告等。
- `计时器(Timers)` - 计时器的作用是：控制多个请求发送的时间频次。
- `配置元素(Configuration Elements)` - 配置元素的工作与采样器的工作类似。但是，它不发送请求，而是提供预备的数据等，如 CSV、函数助手。
- `预处理器元素(Pre-Processor Elements)` - 预处理器元素在采样器发出请求之前执行，如果预处理器附加到采样器元素，那么它将在该采样器元素运行之前执行。预处理器元素用于在运行之前准备环境及参数。
- `后处理器元素(Post-Processor Elements)` - 后处理器元素是在发送采样器请求之后执行的元素，常用于处理响应数据。

![Jmeter](https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/technology/test/jmeter-elements.png)

## 1.1. 创建线程组
菜单路径：`测试计划`-`添加`-`线程（用户）`-`线程组`

参数：
- 取样器错误后要执行的动作
- 线程数：一个用户占一个线程， 100 个线程就是模拟 100 个用户
- Ramp-Up时间（秒）：设置线程需要多长时间全部启动。如果线程数为 200 ，准备时长为 10 ，那么需要 1 秒钟启动 20 个线程。也就是每秒钟启动 20 个线程。
- 循环次数：每个线程发送请求的次数。如果线程数为 200 ，循环次数为 10 ，那么每个线程发送 10 次请求。总请求数为 200*10=2000 。如果勾选了 “永远”，那么所有线程会一直发送请求，直到选择停止运行脚本。

## 1.2. 取样器
### 1.2.1. HTTP请求
菜单路径:`线程组`-`添加`-`取样器`-`HTTP请求`

协议：向目标服务器发送HTTP请求协议，可以是HTTP或HTTPS，默认为HTTP。
服务器名称或IP ：HTTP请求发送的目标服务器名称或IP。
端口号：目标服务器的端口号，默认值为80
方法：发送HTTP请求的方法，可用方法包括GET、POST、HEAD、PUT、OPTIONS、TRACE、DELETE等。
路径：目标URL路径（URL中去掉服务器地址、端口及参数后剩余部分）。
内容编码：编码方式，默认为ISO-8859-1编码，这里配置为utf-8。
参数：同请求一起发送参数 ，在请求中发送的URL参数，用户可以将URL中所有参数设置在本表中，表中每行为一个参数（对应URL中的 key=value），注意参数传入中文时需要勾选“编码”。


## 1.3. 配置元件
### 1.3.1. HTTP信息头管理器
菜单路径:`线程组`-`添加`-`配置元件`-`HTTP信息头管理器`

### 1.3.2. HTTP请求默认值
菜单路径:`线程组`-`添加`-`配置元件`-`HTTP请求默认值`

主要参数：
- `协议`：向目标服务器发送HTTP请求协议，可以是HTTP或HTTPS，默认为HTTP。
- `服务器名称或IP` ：HTTP请求发送的目标服务器名称或IP。
- `端口号`：目标服务器的端口号，默认值为80
- `方法`：发送HTTP请求的方法，可用方法包括`GET、POST、HEAD、PUT、OPTIONS、TRACE、DELETE`等。
- `路径`：目标URL路径（URL中去掉服务器地址、端口及参数后剩余部分）。
- `内容编码`：编码方式，默认为`ISO-8859-1`编码，这里配置为`utf-8`。
- `参数`：同请求一起发送参数 ，在请求中发送的URL参数，用户可以将URL中所有参数设置在本表中，表中每行为一个参数（对应URL中的 key=value），注意参数传入中文时需要勾选“编码”。

## 1.4. 断言
> 断言用来检测响应返回的结果和我们预期的是否一致

### 1.4.1. 响应断言
菜单路径:`线程组`-`添加`-`断言`-`响应断言`

### 1.4.2. JSON断言
菜单路径:`线程组`-`添加`-`断言`-`JSON断言`

## 1.5. 监听器
### 1.5.1. 查看结果树
菜单路径:`线程组`-`添加`-`监听器`-`查看结果树`

### 1.5.2. 汇总报告
菜单路径:`线程组`-`添加`-`监听器`-`汇总报告`

### 1.5.3. 聚合报告
菜单路径:`线程组`-`添加`-`监听器`-`聚合报告`

参数：
- `Label`：每个 `JMeter` 的 `element`（例如我这里只有一个 `Spring WebFlux`）都有一个 `Name` 属性，这里显示的就是 `Name` 属性的值。
- `样本(Samples)`：请求数——表示这次测试中一共发出了多少个请求，模拟了`100`个用户循环`6`次也就为`100*6=600`。
- `平均值(Average)`：平均响应时间(单位:ms)。默认是单个`Request`的平均响应时间，当使用了`Transaction Controller`时，也可以是`Transaction`为单位显示平均响应时间。
- `中位数(Median)`：也就是 `50％` 用户的响应时间。
- `90% 百分位(Line)`：`90％` 用户的响应时间。相邻几个`*%`同意。
- `最小值(Min)`：最小响应时间。
- `最大值(Max)`：最大响应时间。
- `异常(Error) %`：错误率——错误请求数/请求总数。
- `吞吐量(Throughput)`：吞吐量——默认情况下表示每秒完成的请求数（`Request per Second`），当使用了 `Transaction Controller` 时，也可以表示类似 `LoadRunner` 的 `Transaction per Second` 数 。
- `接收 KB/Sec`：每秒从服务器端接收到的数据量，相当于`LoadRunner`中的`Throughput/Sec`。
- `发送 KB/Sec`：每秒向服务器发送的数据量，相当于`LoadRunner`中的`Throughput/Sec`。

## 1.6. 后置处理器
### 1.6.1. 正则表达式提取器


菜单路径:`线程组`-`添加`-`后置处理器`-`正则表达式提取器`

参数：
- 引用名称：其他地方引用提取值的变量名称，如填写的是：str，具体的引用方式是${str}
- 正则表达式：提取内容的正则表达式【稍注意一下：()表示提取，对于你要提前的内容需要用小括号括起来】
- 模板：用$$引用起来，如果在正则表达式中有多个提取表达式（多个括号括起来的东东），则可以是$1$，$2$等等，表示解析到的第几个值给str，正则表达式的提取模式，值从1开始
- 匹配数字(0代表随机)：0代表随机，-1代表所有，其余正整数代表将在已提取的内容中，第几个匹配的内容
- 缺省值：正则匹配失败时，取的值

#### 1.6.1.1. 正则表达式
>正则表达式取值原理:左边界(.+?)右边界

关于正则表达式：
- `()`：括起来的部分就是要提取的。
- `.`：匹配除换行外的任何字符串。
- `+`：代表 + 号前面的字符必须至少出现一次（一次或多次）。
- `?`：代表？前面的字符最多可以出现一次，在找到第一个匹配项后停止（0 次或 1 次）。
- `:`：代表号前面的字符可以不出现，也可以出现一次或者多次（0 次、1 次或者多次）
- `(.)`：贪婪模式，匹配尽可能多的字符
-`(.?)或(.+?)`：匹配尽可能少的字符，一旦匹配到第一个就不往下走了。


## 1.7. 执行测试计划
执行测试计划应该使用`命令行模式`，语法形式如下：

```shell
jmeter -n -t [jmx file] -l [results file] -e -o [Path to web report folder]
```

- `jmx file` 为`测试计划文件路径`
- `results file` 为`测试结果文件路径`
- `Path to web report folder` 为`web报告保存路径`
